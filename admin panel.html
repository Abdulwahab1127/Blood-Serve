<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Administrator Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="administrator-updated2.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>

     <!-- navbar and sidebar -->
    <header id="home">
        <nav class="navbar navbar-expand-lg navbar-light px-4 border-bottom fixed-top">
            <div class="container-fluid">
              <a class="navbar-brand fs-2" href="#">Blood- <span class="text-danger">Serve </span></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 fs-5 text-center">
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#services" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Account
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                      <li><a class="dropdown-item" href="" >Log-out</a></li>
                    </ul>
                  </li> 
                </ul>
              </div>
            </div>
          </nav>

          <div class="container-sideBar">

            <div class="row-1">
                <div class="col-sm-12 col-md-6 col-lg-6 col-12 ">
                    <div class="sidebar">
                        <ul>
                            <li><a href="#DashBoard"><i class="fa-solid fa-gauge"></i> Admin DashBoard</a></li>
                            <li><a href="#DonorTable"><i class="fa-solid fa-table"></i> View Donors</a></li>
                            <li><a href="#DonorHistory"><i class="fa-solid fa-book-medical"></i> View Donor Health History</a></li>
                            <li><a href="#RecipientsTable"><i class="fa-solid fa-table"></i> View Recipients</a></li>
                            <!-- <li><a href="#Requests"><i class="fa-regular fa-comment-dots"></i> Requests</a></li> -->
                            <li class="dropdown">
                              <a href="#Requests" class="dropdown-toggle"><i class="fa-regular fa-comment-dots"></i> Requests</a>
                              <ul class="dropdown-menu">
                                <li><a href="#Pending">Pending</a></li>
                                  <li><a href="#InProgress">In-progress</a></li>                                
                                  <li><a href="#Approved">Approved</a></li>                                 
                              </ul>
                          </li>
                            <li><a href="#Inventory"><i class="fa-solid fa-warehouse"></i> Blood Inventory</a></li>
                            <li><a href="#DonationHistory"><i class="fa-solid fa-hand-holding-droplet"></i> View Donation History</a></li>
                        </ul>
                    </div>
                </div>  
          </div>
        </div>

    </header>


  <section class="dashboard" id="DashBoard">
    <div class="container-dashboard">
        <div class="container-text my-5 py-5">
            <h4>Admin <span class="text-danger"> DashBoard </span></h4>
            <hr>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-6 col-lg-6 col-12">
                <div class="card-eligibility">
                    <div class="card-body">
                        <i class="fa-solid fa-users-line"></i>
                        <h2 id="eligible-donors-count" class="card-title">10</h2>
                        <p class="card-text">Donors Eligible to donate</p>
                        <button class="btn btn-danger" data-toggle="modal" data-target="#eligibilityModal">View Details</button>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-6 col-12">
                <div class="card-tests">
                    <div class="card-body">
                        <i class="fa-solid fa-vials"></i>
                        <h2 class="card-title">15</h2>
                        <p class="card-text">Blood Tests Available</p>
                        <button class="btn btn-danger" data-toggle="modal" data-target="#testsModal">View Details</button>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-6 col-12 mt-4">
                <div class="card-transfusion">
                    <div class="card-body">
                        <i class="fa-solid fa-bed-pulse"></i>
                        <h2 class="card-title">5</h2>
                        <p class="card-text">Recipients waiting for Transfusion Process</p>
                        <button class="btn btn-danger" data-toggle="modal" data-target="#transfusionModal">View Details</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Eligibility Modal -->
<div class="modal fade" id="eligibilityModal" tabindex="-1" role="dialog" aria-labelledby="eligibilityModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="eligibilityModalLabel">Donors Eligible to Donate</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <table id="eligibilityTable-table" >
              <thead>
                  <tr>
                    <th>Eligibility ID</th>
                    <th>Donor Id</th>
                    <th>Donation Id</th>
                    <th>Eligibility Status</th>
                    <th>Comment</th>
                  </tr>
              </thead>
              <tbody id="eligibilityTable-table-body">
                  
              </tbody>
          </table>
          </div>
      </div>
  </div>
</div>



<!-- Tests Modal -->
<div class="modal fade" id="testsModal" tabindex="-1" role="dialog" aria-labelledby="testsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="testsModalLabel">Blood Tests Available</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <table id="testsTable-table" >
              <thead>
                  <tr>
                    <th>Test Id</th>
                    <th>Test Date</th>
                    <th>Blood Type</th>
                    <th>Hemoglobin Level</th>
                    <th>Donor Id</th>
                    <th>Donation Id</th>
                    <th>Recipient Id</th>
                  </tr>
              </thead>
              <tbody id="testsTable-table-body">
                  
              </tbody>
          </table>
          </div>
      </div>
  </div>
</div>


<!-- transfusion -->
   
 <div class="modal fade" id="transfusionModal" tabindex="-1" role="dialog" aria-labelledby="transfusionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="transfusionModalLabel">Transfusion Process Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table id="transfusionTable">
                    <thead>

                  <tr>
                    <th>Transfusion ID</th>
                    <th>Recipient Id</th>
                    <th>Hospital Id</th>
                    <th>Donation Id</th>
                    <th>Transfusion Date</th>
                    <th>Blood Type</th>
                    <th>Quantity</th>
                    <th>Status</th>
                </tr>
            </thead>
              <tbody id="transfusionTable-table-body">
                  
              </tbody>
          </table>
          </div>
      </div>
  </div>
</div>

   




    <!-- Donors Table -->
    <!-- <section class="Donors" id="DonorTable">
      <div class="container-dashboard ">
        <div class="container-text  my-5 py-5">
            <h4>View <span class="text-danger"> Donors </span></h4>
        <hr>
    </div>

      <div class="container">
        <h3>Donors List</h3>
        <input type="text" id="search-bar" placeholder="Search donors..." class="form-control mb-3">
        <table id="donors-table" >
            <thead>
                <tr>
                    <th>Donor ID</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Blood Type</th>
                    <th>Contact Info</th>
                </tr>
            </thead>
            <tbody id="donors-table-body">
                
            </tbody>
        </table>
    </div>
    </section> -->

    <section class="Donors" id="DonorTable">
      <div class="container-dashboard">
          <div class="container-text my-5 py-5">
              <h4>View <span class="text-danger"> Donors </span></h4>
              <hr>
          </div>
  
          <div class="container">
              <h3>Donors List</h3>
              <input type="text" id="search-bar" placeholder="Search donors..." class="form-control mb-3">
              <table id="donors-table">
                  <thead>
                      <tr>
                          <th>Donor ID</th>
                          <th>Name</th>
                          <th>Age</th>
                          <th>Gender</th>
                          <th>Blood Type</th>
                          <th>Contact Info</th>
                          <th>Actions</th>
                      </tr>
                  </thead>
                  <tbody id="donors-table-body">
                  </tbody>
              </table>
          </div>
      </div>
  </section>
  


    <!-- Donors Health History -->
    <section class="Donor-History" id="DonorHistory">
      <div class="container-dashboard ">
        <div class="container-text  my-5 py-5">
            <h4>View Donor <span class="text-danger"> Health History </span></h4>
        <hr>
    </div>

    <div class="container">
      <h3>Health History</h3>
      <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search..." onkeyup="searchTable()">
      <!-- <input type="text" id="search-bar" placeholder="Search health history..." class="form-control mb-3"> -->
      <table id="donorsHistory-table">
          <thead>
              <tr>
                  <th>Donor Health History ID</th>
                  <th>Donor ID</th>
                  <th>Medical Conditions</th>
                  <th>Medications</th>
                  <th>Allergies</th>
                  <th>Past Surgeries</th>   
              </tr>
          </thead>
          <tbody id="donors-history-table-body">
              
          </tbody>
      </table>
  </div>

    </section>

    <!-- Recipients -->
    <section class="Recipients" id="RecipientsTable">
      <div class="container-dashboard ">
        <div class="container-text  my-5 py-5">
            <h4>View <span class="text-danger"> Recipients </span></h4>
        <hr>
    </div>

    <div class="container">
      <h3>Recipients List</h3>
      <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search..." onkeyup="searchTable()">
      <table id="recipients-table">
          <thead>
              <tr>
                  <th>Recipient ID</th>
                  <th>Name</th>
                  <th>Age</th>
                  <th>Gender</th>
                  <th>Blood Type</th>
                  <th>Contact Info</th>
              </tr>
          </thead>
          <tbody id="recipients-table-body">
              
          </tbody>
      </table>
  </div>

    </section>

      <!-- Requests -->
<section class="Requests" id="Requests">
  <div class="container-dashboard">
    <div class="container-text my-5 py-5">
      <h4>View <span class="text-danger">Requests</span></h4>
      <hr>
    </div>

    <div class="Pending-Requests" id="Pending">
      <h4>Pending Requests</h4>
      <div class="row" id="PendingContainer">
        <!-- Pending requests will be dynamically populated here -->
      </div>
    </div>

    <div class="InProgress-Requests" id="InProgress">
      <h4>In-progress Requests</h4>
      <div class="row" id="InProgressContainer">
        <!-- In-progress requests will be dynamically populated here -->
      </div>
    </div>

    <div class="Approved-Requests" id="Approved">
      <h4>Approved Requests</h4>
      <div class="row" id="ApprovedContainer">
        <!-- Approved requests will be dynamically populated here -->
      </div>
    </div>
  </div>
</section>

   <!-- Blood Inventory -->
   <section class="Blood-Inventory" id="Inventory">
    <div class="container-dashboard ">
      <div class="container-text  my-5 py-5">
          <h4>View <span class="text-danger">Blood-Inventory </span></h4>
      <hr>
  </div>

  <div class="container">
    <h3>Blood Inventory</h3>
    <!-- <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search..." onkeyup="searchTable()"> -->
    <input type="text" id="search-bar" placeholder="Search..." class="form-control mb-3"> 
    <table id="bloodInventory-table">
        <thead>
            <tr>
                <th>Inventory ID</th>
                <th>Bank ID</th>
                <th>Blood Type</th>
                <th>Quantity</th>
                <th>Expiry date</th>   
            </tr>
        </thead>
        <tbody id="bloodInventory-table-body">
            
        </tbody>
    </table>
</div>

  </section>

  <!-- to view donation history -->
  <section class="Donation-History" id="DonationHistory">
    <div class="container-dashboard ">
      <div class="container-text  my-5 py-5">
          <h4>View <span class="text-danger">Donation-History </span></h4>
      <hr>
  </div>

  
  <div class="container">
    <h3>Donation History List</h3>
    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search..." onkeyup="searchTable()">

    <table id="donationTable">
        <thead>
            <tr>
              <th>Donation ID</th>
              <th>Donation Date</th>
              <th>Blood Type</th>
              <th>Quantity</th>
              <th>Hemoglobin Level</th>
              <th>Status</th>
              <th>Donor ID</th>
            </tr>
        </thead>
        <tbody id="donationData-table-body">
            
        </tbody>
    </table>
</div>


  </section>


     <!-- Java Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
     
    <!-- to view donors table -->
    
  <!-- <script>
    document.addEventListener('DOMContentLoaded', () => {
  const tableBody = document.querySelector('#donors-table-body');
  const searchBar = document.querySelector('#search-bar');

  fetch('http://localhost:10000/donor')
    .then(response => response.json())
    .then(data => {
      console.log(data);
      populateTable(data);

      searchBar.addEventListener('input', () => {
        const searchTerm = searchBar.value.toLowerCase();
        const filteredData = data.filter(donor =>
          donor.donor_id.toString().includes(searchTerm) ||
          donor.name.toLowerCase().includes(searchTerm) ||
          donor.age.toString().includes(searchTerm) ||
          donor.gender.toLowerCase().includes(searchTerm) ||
          donor.blood_type.toLowerCase().includes(searchTerm)
        );
        populateTable(filteredData);
      });
    })
    .catch(error => console.error('Error fetching data:', error));

  function populateTable(donors) {
    tableBody.innerHTML = '';
    donors.forEach(donor => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${donor.donor_id}</td>
        <td>${donor.name}</td>
        <td>${donor.age}</td>
        <td>${donor.gender}</td>
        <td>${donor.blood_type}</td>
        <td>${donor.contact_info}</td>
        <td><button class="delete-btn" data-id="${donor.donor_id}">Delete</button></td>
      `;
      tableBody.appendChild(row);
    });

    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', (event) => {
        const donorId = event.target.getAttribute('data-id');
        fetch(`http://localhost:10000/donor/${donorId}`, {
          method: 'DELETE'
        })
        .then(response => response.json())
        .then(result => {
          if (result.message) {
            event.target.closest('tr').remove();
          } else {
            console.error('Error deleting donor:', result.error);
          }
        })
        .catch(error => console.error('Error:', error));
      });
    });
  }
});

  </script> -->

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const tableBody = document.querySelector('#donors-table-body');
        const searchBar = document.querySelector('#search-bar');

        let donorsData = []; // Store the original donor data

        fetch('http://localhost:10000/donor')
            .then(response => response.json())
            .then(data => {
                donorsData = data; // Save the original donor data
                populateTable(data);
            })
            .catch(error => console.error('Error fetching data:', error));

        // Function to populate the donor table
        function populateTable(data) {
            tableBody.innerHTML = ''; // Clear the table body
            data.forEach(donor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${donor.donor_id}</td>
                    <td>${donor.name}</td>
                    <td>${donor.age}</td>
                    <td>${donor.gender}</td>
                    <td>${donor.blood_type}</td>
                    <td>${donor.contact_info}</td>
                    <td><button class="delete-btn" data-id="${donor.donor_id}">Delete</button></td>
                `;
                tableBody.appendChild(row);
            });
            addDeleteEventListeners(); // Add event listeners to the delete buttons
        }

        // Event listener for the search bar
        searchBar.addEventListener('input', () => {
            const searchTerm = searchBar.value.toLowerCase();
            const filteredData = donorsData.filter(donor =>
                donor.name.toLowerCase().includes(searchTerm) ||
                donor.donor_id.toLowerCase().includes(searchTerm) ||
                donor.blood_type.toLowerCase().includes(searchTerm) ||
                donor.contact_info.toLowerCase().includes(searchTerm)
            );
            populateTable(filteredData);
        });

        // Function to add event listeners to delete buttons
        function addDeleteEventListeners() {
            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const donorId = button.getAttribute('data-id');
                    deleteDonor(donorId);
                });
            });
        }

        // Function to delete a donor
        function deleteDonor(donorId) {
            fetch(`http://localhost:10000/donor/${donorId}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    // Remove the donor from the donorsData array
                    donorsData = donorsData.filter(donor => donor.donor_id !== donorId);
                    // Repopulate the table with the updated data
                    populateTable(donorsData);
                } else {
                    console.error('Error deleting donor');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    });
</script>
    





  <!-- hiba's updated code -->
  <!-- <script>
    document.addEventListener('DOMContentLoaded', () => {
    const tableBody = document.querySelector('#donors-table-body');
    const searchBar = document.querySelector('#search-bar');

    let donorsData = []; // Store the original donor data

    fetch('http://localhost:10000/donor')
        .then(response => response.json())
        .then(data => {
            donorsData = data; // Save the original donor data
            populateTable(data);
        })
        .catch(error => console.error('Error fetching data:', error));

    // Function to populate the donor table
    function populateTable(data) {
        tableBody.innerHTML = ''; // Clear the table body
        data.forEach(donor => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${donor.donor_id}</td>
                <td>${donor.name}</td>
                <td>${donor.age}</td>
                <td>${donor.gender}</td>
                <td>${donor.blood_type}</td>
                <td>${donor.contact_info}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Event listener for the search bar
    searchBar.addEventListener('input', () => {
        const searchTerm = searchBar.value.toLowerCase();
        const filteredData = donorsData.filter(donor =>
            donor.name.toLowerCase().includes(searchTerm) ||
            donor.donor_id.toLowerCase().includes(searchTerm) ||
            donor.blood_type.toLowerCase().includes(searchTerm) ||
            donor.contact_info.toLowerCase().includes(searchTerm)
        );
        populateTable(filteredData);
    });
});
  </script> -->
<!--   
hafsa updated code
  <script>
    document.addEventListener('DOMContentLoaded', () => {
    const tableBody = document.querySelector('#donors-table-body');
    const searchBar = document.querySelector('#search-bar');

    let donorsData = []; // Store the original donor data

    fetch('http://localhost:10000/donor')
        .then(response => response.json())
        .then(data => {
            donorsData = data; // Save the original donor data
            populateTable(data);
        })
        .catch(error => console.error('Error fetching data:', error));

    // Function to populate the donor table
    function populateTable(data) {
        tableBody.innerHTML = ''; // Clear the table body
        data.forEach(donor => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${donor.donor_id}</td>
                <td>${donor.name}</td>
                <td>${donor.age}</td>
                <td>${donor.gender}</td>
                <td>${donor.blood_type}</td>
                <td>${donor.contact_info}</td>
                <td><button class="delete-btn btn btn-danger" data-id="${donor.donor_id}">Delete</button></td>
            `;
            tableBody.appendChild(row);
        });

        // Add event listeners to delete buttons
        const deleteButtons = document.querySelectorAll('.delete-btn');
        deleteButtons.forEach(button => {
            button.addEventListener('click', handleDelete);
        });
    }

    // Event listener for the search bar
    searchBar.addEventListener('input', () => {
        const searchTerm = searchBar.value.toLowerCase();
        const filteredData = donorsData.filter(donor =>
            donor.name.toLowerCase().includes(searchTerm) ||
            donor.donor_id.toLowerCase().includes(searchTerm) ||
            donor.blood_type.toLowerCase().includes(searchTerm) ||
            donor.contact_info.toLowerCase().includes(searchTerm)
        );
        populateTable(filteredData);
    }); -->

    // Function to handle delete button click
    function handleDelete(event) {
        const donorId = event.target.getAttribute('data-id');

        fetch(`http://localhost:10000/donor/${donorId}`, {
            method: 'DELETE',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to delete donor');
            }
            return response.json();
        })
        .then(data => {
            alert(data.message);
            donorsData = donorsData.filter(donor => donor.donor_id !== donorId);
            populateTable(donorsData);
        })
        .catch(error => console.error('Error deleting donor:', error));
    }
});

  </script>
 

 

  <!-- view donor history -->
  
    <script>
      document.addEventListener('DOMContentLoaded', () => {
const tableBody = document.querySelector('#donors-history-table-body');
const searchBar = document.querySelector('#search-bar');

    fetch('http://localhost:10000/donorhealthhistory')
        .then(response => response.json())
        .then(data => {
          console.log(data);
          populateTable(data);

          
    searchBar.addEventListener('input', () => {
      const searchTerm = searchBar.value.toLowerCase();
      const filteredData = data.filter(donorHealthHistory =>
        donorHealthHistory.healthhistoryid.toString().includes(searchTerm) ||
        donorHealthHistory.medicalconditions.toString().includes(searchTerm) ||
        donorHealthHistory.medications.toLowerCase().includes(searchTerm) ||
        donorHealthHistory.allergies.toLowerCase().includes(searchTerm) ||
        donorHealthHistory.pastsurgeries.toLowerCase().includes(searchTerm) ||
        donorHealthHistory.donorid.toLowerCase().includes(searchTerm) 
      );
      populateTable(filteredData);
    });
  })
  .catch(error => console.error('Error fetching data:', error));

              
  function populateTable(donorHealthHistory) {
  tableBody.innerHTML = '';
  donorHealthHistory.forEach(donorHealthHistory => {
    const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${donorHealthHistory.healthhistoryid}</td>
                    <td>${donorHealthHistory.donorid}</td>
                    <td>${donorHealthHistory.medicalconditions}</td>
                    <td>${donorHealthHistory.medications}</td>
                    <td>${donorHealthHistory.allergies}</td>
                    <td>${donorHealthHistory.pastsurgeries}</td>
                    
                `;
                tableBody.appendChild(row);
            });
          }
        });
      
</script>  

  
 
  
   
  
    <!-- Recipients -->
    
<script>
  // Fetch recipient data from the server
  fetch('http://localhost:10000/recipient')
      .then(response => response.json())
      .then(data => {
          console.log(data);

          const tableBody = document.getElementById('recipients-table-body');
          tableBody.innerHTML = '';

          data.forEach(recipient => {
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${recipient.recipient_id}</td>
                  <td>${recipient.name}</td>
                  <td>${recipient.age}</td>
                  <td>${recipient.gender}</td>
                  <td>${recipient.blood_type}</td>
                  <td>${recipient.contact_info}</td>
              `;
              tableBody.appendChild(row);
          });
      })
      .catch(error => console.error('Error fetching data:', error));

  // Function to search and filter the table
  function searchTable() {
      const input = document.getElementById('searchInput');
      const filter = input.value.toLowerCase();
      const table = document.getElementById('recipients-table');
      const tr = table.getElementsByTagName('tr');

      for (let i = 1; i < tr.length; i++) {
          tr[i].style.display = 'none';
          const td = tr[i].getElementsByTagName('td');
          for (let j = 0; j < td.length; j++) {
              if (td[j]) {
                  if (td[j].innerText.toLowerCase().indexOf(filter) > -1) {
                      tr[i].style.display = '';
                      break;
                  }
              }
          }
      }
  }
</script>
  
  <!-- drop-down -->
  <script>
document.addEventListener('DOMContentLoaded', function() {
    var dropdowns = document.querySelectorAll('.dropdown-toggle');

    dropdowns.forEach(function(dropdown) {
        dropdown.addEventListener('click', function(e) {
            e.preventDefault();
            var menu = this.nextElementSibling;
            menu.classList.toggle('show');
        });
    });

    document.addEventListener('click', function(e) {
        dropdowns.forEach(function(dropdown) {
            var menu = dropdown.nextElementSibling;
            if (!dropdown.contains(e.target)) {
                menu.classList.remove('show');
            }
        });
    });
});

  </script>

<!-- requests stuff -->

    <script> //database se fetch kr raha
      document.addEventListener('DOMContentLoaded', () => {
  const pendingContainer = document.getElementById('PendingContainer');
  const inProgressContainer = document.getElementById('InProgressContainer');
  const approvedContainer = document.getElementById('ApprovedContainer');

  fetch('http://localhost:10000/recipient')
    .then(response => response.json())
    .then(data => {
      const pendingRequests = data.map(item => ({ name: item.name }));
      populatePendingRequests(pendingRequests);
    })
    .catch(error => console.error('Error fetching data:', error));

  function populatePendingRequests(requests) {
    requests.forEach(request => {
      const card = createCard(request.name, 'Pending');
      pendingContainer.appendChild(card);
    });
  }

  function createCard(name, status) {
    const card = document.createElement('div');
    card.className = 'col-sm-12 col-md-4 col-lg-4 col-12 my-5';
    card.innerHTML = `
      <div class="card" style="width: 22rem; height: 13rem;">
        <div class="card-body">
          <h5 class="card-title">${name}</h5>
          <div class="button-group">
            ${status === 'Pending' ? `
              <a href="#" class="btn btn-danger mt-3 accept-button" style="width: 150px;"><i class="fa-solid fa-user-check"></i> Accept</a>
              <a href="#" class="btn btn-danger mt-3 decline-button" style="width: 150px;"><i class="fa-solid fa-user-slash"></i> Decline</a>
            ` : ''}
            ${status === 'InProgress' ? `
              <a href="#" class="btn btn-danger mt-3 approve-button" style="width: 150px;"><i class="fa-solid fa-user-check"></i> Approve</a>
            ` : ''}
          </div>
        </div>
      </div>
    `;

    if (status === 'Pending') {
      card.querySelector('.accept-button').addEventListener('click', (e) => {
        e.preventDefault();
        moveToInProgress(card);
      });
    }

    if (status === 'InProgress') {
      card.querySelector('.approve-button').addEventListener('click', (e) => {
        e.preventDefault();
        moveToApproved(card);
      });
    }

    return card;
  }

  function moveToInProgress(card) {
    card.querySelector('.button-group').innerHTML = `
      <a href="#" class="btn btn-danger mt-3 approve-button" style="width: 150px;"><i class="fa-solid fa-user-check"></i> Approve</a>
    `;
    card.querySelector('.approve-button').addEventListener('click', (e) => {
      e.preventDefault();
      moveToApproved(card);
    });
    inProgressContainer.appendChild(card);
  }

  function moveToApproved(card) {
    card.querySelector('.button-group').innerHTML = ''; //approved icon add kr skte
    approvedContainer.appendChild(card);
  }
});

    </script>

  <!-- to view Blood-Inventory -->
  <script>
    // Fetch recipient data from the server
     fetch('http://localhost:10000/bloodinventory')
         .then(response => response.json())
         .then(data => {
             console.log(data);
  
            
             const tableBody = document.getElementById('bloodInventory-table-body');
  
             tableBody.innerHTML = '';
  
             data.forEach(Blood_Inventory => {
                 const row = document.createElement('tr');
                
                 row.innerHTML = `
                     <td>${Blood_Inventory.inventory_id}</td>
                     <td>${Blood_Inventory.bank_id}</td>
                     <td>${Blood_Inventory.blood_type}</td>
                     <td>${Blood_Inventory.quantity}</td>
                     <td>${Blood_Inventory.expiry_date}</td>
                 `;
                 // Append the row to the table body
                 tableBody.appendChild(row);
             });
         })
         .catch(error => console.error('Error fetching data:', error));

          function searchTable() {
       const input = document.getElementById('searchInput');
       const filter = input.value.toLowerCase();
       const table = document.getElementById('bloodInventory-table');
       const tr = table.getElementsByTagName('tr');

       for (let i = 1; i < tr.length; i++) {
           tr[i].style.display = 'none';
           const td = tr[i].getElementsByTagName('td');
           for (let j = 0; j < td.length; j++) {
               if (td[j]) {
                   if (td[j].innerText.toLowerCase().indexOf(filter) > -1) {
                       tr[i].style.display = '';
                       break;
                   }
               }
           }
       }
   }

  
  </script>
    
  <!-- to view Donation-History -->
  
<script>
  fetch('http://localhost:10000/donationhistory')
      .then(response => response.json())
      .then(data => {
        console.log(data);
          const tableBody = document.querySelector('#donationData-table-body');
          tableBody.innerHTML = '';

          data.forEach(donationhistory => {
              const row = document.createElement('tr');
              row.innerHTML = `
              <td>${donationhistory.donationid}</td>
                <td>${new Date(donationhistory.donationdate).toLocaleDateString()}</td>
                <td>${donationhistory.bloodtype}</td>
                <td>${donationhistory.quantity}</td>
                <td>${donationhistory.hemoglobinlevel}</td>
                <td>${donationhistory.donationstatus}</td>
                <td>${donationhistory.donorid}</td>
              `;
              tableBody.appendChild(row);
          });
      })
      .catch(error => console.error('Error fetching data:', error));


      
  // Function to search and filter the table
  function searchTable() {
      const input = document.getElementById('searchInput');
      const filter = input.value.toLowerCase();
      const table = document.getElementById('recipients-table');
      const tr = table.getElementsByTagName('tr');

      for (let i = 1; i < tr.length; i++) {
          tr[i].style.display = 'none';
          const td = tr[i].getElementsByTagName('td');
          for (let j = 0; j < td.length; j++) {
              if (td[j]) {
                  if (td[j].innerText.toLowerCase().indexOf(filter) > -1) {
                      tr[i].style.display = '';
                      break;
                  }
              }
          }
      }
  }
</script>

 
<!-- eligibility -->
 <script>
  document.addEventListener('DOMContentLoaded', () => {
      const eligibilityTableBody = document.querySelector('#eligibilityTable-table-body');
  
      // Fetch the eligibility data when the modal is about to be shown
      $('#eligibilityModal').on('show.bs.modal', function (event) {
          fetchEligibilityData();
      });
  
      function fetchEligibilityData() {
          fetch('http://localhost:10000/donoreligibility')
              .then(response => response.json())
              .then(data => {
                  console.log(data);
                  populateEligibilityTable(data);
              })
              .catch(error => console.error('Error fetching eligibility data:', error));
      }
  
      function populateEligibilityTable(data) {
          eligibilityTableBody.innerHTML = '';
          data.forEach(item => {
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${item.eligibilityid}</td>
                  <td>${item.donorid}</td>
                  <td>${item.donationid}</td>
                  <td>${item.eligibililtystatus}</td>
                  <td>${item.comment}</td>
              `;
              eligibilityTableBody.appendChild(row);
          });
      }
  });

  
  </script> 


<!-- Blood Tests -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const testsTableBody = document.querySelector('#testsTable-table-body');
  
      // Fetch the blood tests data when the modal is about to be shown
      $('#testsModal').on('show.bs.modal', function (event) {
          fetchBloodTestsData();
      });
  
      function fetchBloodTestsData() {
          fetch('http://localhost:10000/bloodtests')
              .then(response => response.json())
              .then(data => {
                  console.log(data);
                  populateBloodTestsTable(data);
              })
              .catch(error => console.error('Error fetching blood tests data:', error));
      }
  
      function populateBloodTestsTable(data) {
          testsTableBody.innerHTML = '';
          data.forEach(item => {
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${item.testid}</td>
                  <td>${item.testdate}</td>
                  <td>${item.bloodtype}</td>
                  <td>${item.hemoglobinlevel}</td>
                  <td>${item.donorid}</td>
                  <td>${item.donationid}</td>
                  <td>${item.recipientid}</td>
              `;
              testsTableBody.appendChild(row);
          });
      }
  });
</script>





<!-- transfusion -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const transfusionTableBody = document.querySelector('#transfusionTable-table-body');
  
      // Fetch the transfusion data when the modal is about to be shown
      $('#transfusionModal').on('show.bs.modal', function (event) {
          fetchTransfusionData();
      });
  
      function fetchTransfusionData() {
          fetch('http://localhost:10000/transfusion')
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  return response.json();
              })
              .then(data => {
                  populateTransfusionTable(data);
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
      }
  
      function populateTransfusionTable(data) {
          transfusionTableBody.innerHTML = ''; // Clear existing table body
          data.forEach(transfusion => {
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${transfusion.transfusionid}</td>
                  <td>${transfusion.recipientid}</td>
                  <td>${transfusion.hospital_id}</td>
                  <td>${transfusion.donationid}</td>
                  <td>${transfusion.transfusiondate}</td>
                  <td>${transfusion.bloodtype}</td>
                  <td>${transfusion.quantity}</td>
                  <td>${transfusion.status}</td>
              `;
              transfusionTableBody.appendChild(row);
          });
      }
  });
</script>






    
  </body>
</html>